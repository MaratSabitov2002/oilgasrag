# Прототип RAG-системы для ответов по технической документации нефтегазовой отрасли

---

## Описание этапов сбора и предобработки данных

Для создания базы данных было собрано 53 документа из электронного ресурса [OGBUS](http://www.ogbus.ru), специализирующегося на нефтегазовой тематике. Документы включают статьи и технические материалы, все на русском языке.

Тексты были извлечены и сохранены в едином текстовом файле формата `.txt`. Для каждого фрагмента текста дополнительно сохранялись метаданные: источник, название статьи и номер страницы, с которой был взят текст.

Далее текст был разбит на чанки заданной длины с перекрытием. При этом крайние слова в чанках отбрасывались, чтобы избежать их усечения и некорректного состава слов.

Для векторного индексирования чанков использовалась база ChromaDB, где хранились как эмбеддинги, так и метаданные каждого чанка.

---

## Схема архитектуры RAG

1. **Сбор данных:** Сбор документов из открытых отраслевых источников (в данном случае — OGBUS).
2. **Предобработка:** Конвертация документов в единый текстовый формат, очистка и сохранение метаданных.
3. **Деление на чанки:** Разбиение текста с перекрытием для более точного поиска.
4. **Векторное хранилище:** Индексация чанков с помощью ChromaDB.
5. **Retriever:** Поиск топ-5 релевантных чанков для заданного вопроса.
6. **Generator:** Генерация ответа на основе контекста из найденных чанков с помощью LLM (провайдер GigaChat).
7. **Фронтенд:** Веб-интерфейс на Streamlit для ввода вопросов и отображения ответов.

---

## Примеры запросов и ответов

1. **Вопрос:** Каковы основные требования к буровым растворам в нефтедобыче?  
   **Ответ:** Основные требования включают стабильность, несущую способность и совместимость с породой. Для более точного ответа см. документацию из источника "Стандарты нефтегазовой отрасли", стр. 45.

2. **Вопрос:** Какие стандарты регулируют техническое обслуживание компрессоров?  
   **Ответ:** В соответствии со стандартом ГОСТ Р 54175-2010, техническое обслуживание должно проводиться с периодичностью не реже одного раза в полгода.

3. **Вопрос:** Каковы методы предотвращения коррозии в трубопроводах?  
   **Ответ:** Методы включают применение ингибиторов, защитных покрытий и катодной защиты.

4. **Вопрос:** Как происходит контроль качества нефти на добыче?  
   **Ответ:** Не знаю.

5. **Вопрос:** Какие требования предъявляются к системам мониторинга скважин?  
   **Ответ:** Системы мониторинга должны обеспечивать непрерывный сбор данных в реальном времени, иметь высокую точность и устойчивость к экстремальным условиям.

---

## Детальное обоснование выбора LLM

Для генерации ответов была выбрана модель провайдера **GigaChat** с тремя вариантами моделей: light, pro и max. Основные причины выбора:

- **Качество генерации:** Модели GigaChat показывают высокое качество текстов, особенно в технической и отраслевой тематике, благодаря хорошему обучению на профильных данных.
- **Производительность:** Использование API-решения позволило избежать необходимости локального развертывания тяжелых моделей, что важно при ограничениях по аппаратным ресурсам.
- **Соответствие задаче:** GigaChat предоставляет гибкие модели под разные задачи и нагрузку, что удобно при построении прототипа RAG. Легко масштабируется и интегрируется с пайплайном.

Таким образом, преимущество было отдано облачному API-решению, что ускорило разработку и упростило поддержку.

---

## Дополнительные улучшения

- Добавлен системный промпт для более точного ограничения генерации ответов строго контекстом:  
  `"Ответь ТОЛЬКО на основе контекста ниже. Если ответа нет, скажи 'Не знаю'.\n Контекст {релевантные_чанки}\n\nВопрос: {вопрос}\nОтвет:"`

- Реализован веб-интерфейс на Streamlit, позволяющий быстро и удобно вводить вопросы и получать ответы.

- В процессе работы планируется расширить базу документов и добавить поддержку более сложных типов запросов с интерактивным уточнением.

---

## Инструкция по запуску через GitHub

1. Клонируйте репозиторий и перейдите в его директорию:

   ```bash
   git clone https://github.com/MaratSabitov2002/oilgasrag.git
   cd oilgasrag

2. Установите зависимости:

    ```bash
    pip install -r requirements.txt

3. Установите пакет в режиме разработки:

    ```bash
    pip install -e .

4. Запустите приложение:

    ```bash
    python data/app.py
    
5. Откройте в браузере адрес, указанный в консоли (обычно http://localhost:8501) для работы с интерфейсом.
---

## Запуск через Docker

Для запуска приложения с использованием Docker выполните следующие шаги:

1. Скачайте Docker-образ

```bash
    docker pull maratsabitov/oilgasrag-app:latest
```

2. Подготовьте файл .env. Создайте файл .env, в котором укажите ваши ключи доступа к API моделей GigaChat. Пример содержимого:

```python

    GIGACHAT_API=your_api_key_here
    # example:
    # GIGACHAT_API=qwerty123
```
3. Запуск контейнера

```bash
    docker run -p 8501:8501 --env-file .env oilgasrag-app
```

Если файл .env находится в другом месте, укажите путь явно:
```
docker run -p 8501:8501 --env-file /полный_путь_к/.env oilgasrag-app
```
4. После запуска откройте браузер и перейдите по адресу http://localhost:8501

